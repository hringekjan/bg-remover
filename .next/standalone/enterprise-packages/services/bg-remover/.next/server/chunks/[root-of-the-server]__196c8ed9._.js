module.exports=[66680,(e,r,t)=>{r.exports=e.x("node:crypto",()=>require("node:crypto"))},60526,(e,r,t)=>{r.exports=e.x("node:os",()=>require("node:os"))},50227,(e,r,t)=>{r.exports=e.x("node:path",()=>require("node:path"))},81386,e=>{"use strict";e.s([],96284),e.i(96284);var r=e.i(84396),t=e.i(35926),i=e.i(3993),n=e.i(18795),s=e.i(64279);let o=e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p"),a=async(t,a,c,d={},g)=>{c.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");let f=a[t],{source_profile:u,region:_}=f;if(!c.roleAssumer){let{getDefaultRoleAssumer:r}=await e.A(41435);c.roleAssumer=r({...c.clientConfig,credentialProviderLogger:c.logger,parentClientConfig:{...c?.parentClientConfig,region:_??c?.parentClientConfig?.region}},c.clientPlugins)}if(u&&u in d)throw new i.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${(0,r.getProfileName)(c)}. Profiles visited: `+Object.keys(d).join(", "),{logger:c.logger});c.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${u?`source_profile=[${u}]`:`profile=[${t}]`}`);let p=u?g(u,a,c,{...d,[u]:!0},l(a[u]??{})):(await ((r,t,n)=>{let a={EcsContainer:async r=>{let{fromHttp:t}=await e.A(40077),{fromContainerMetadata:i}=await e.A(54462);return n?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>(0,s.chain)(t(r??{}),i(r))().then(o)},Ec2InstanceMetadata:async r=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");let{fromInstanceMetadata:t}=await e.A(54462);return async()=>t(r)().then(o)},Environment:async r=>{n?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");let{fromEnv:t}=await e.A(36989);return async()=>t(r)().then(o)}};if(r in a)return a[r];throw new i.CredentialsProviderError(`Unsupported credential source in profile ${t}. Got ${r}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger:n})})(f.credential_source,t,c.logger)(c))();if(l(f))return p.then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));{let e={RoleArn:f.role_arn,RoleSessionName:f.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:f.external_id,DurationSeconds:parseInt(f.duration_seconds||"3600",10)},{mfa_serial:r}=f;if(r){if(!c.mfaCodeProvider)throw new i.CredentialsProviderError(`Profile ${t} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:c.logger,tryNextLink:!1});e.SerialNumber=r,e.TokenCode=await c.mfaCodeProvider(r)}let s=await p;return c.roleAssumer(s,e).then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},l=e=>!e.role_arn&&!!e.credential_source;var c=e.i(240),d=e.i(96370),g=e.i(66680),f=e.i(2157),u=e.i(60526),_=e.i(50227);class p{profileData;init;callerClientConfig;static REFRESH_THRESHOLD=3e5;constructor(e,r,t){this.profileData=e,this.init=r,this.callerClientConfig=t}async loadCredentials(){let e=await this.loadToken();if(!e)throw new i.CredentialsProviderError(`Failed to load a token for session ${this.loginSession}, please re-authenticate using aws login`,{tryNextLink:!1,logger:this.logger});let r=e.accessToken,t=Date.now();return new Date(r.expiresAt).getTime()-t<=p.REFRESH_THRESHOLD?this.refresh(e):{accessKeyId:r.accessKeyId,secretAccessKey:r.secretAccessKey,sessionToken:r.sessionToken,accountId:r.accountId,expiration:new Date(r.expiresAt)}}get logger(){return this.init?.logger}get loginSession(){return this.profileData.login_session}async refresh(r){let t,{SigninClient:n,CreateOAuth2TokenCommand:s}=await e.A(66803),{logger:o,userAgentAppId:a}=this.callerClientConfig??{},l=(t=this.callerClientConfig?.requestHandler,t?.metadata?.handlerProtocol==="h2")?void 0:this.callerClientConfig?.requestHandler,c=new n({credentials:{accessKeyId:"",secretAccessKey:""},region:this.profileData.region??await this.callerClientConfig?.region?.()??process.env.AWS_REGION,requestHandler:l,logger:o,userAgentAppId:a,...this.init?.clientConfig});this.createDPoPInterceptor(c.middlewareStack);let d={tokenInput:{clientId:r.clientId,refreshToken:r.refreshToken,grantType:"refresh_token"}};try{let e=await c.send(new s(d)),{accessKeyId:t,secretAccessKey:n,sessionToken:o}=e.tokenOutput?.accessToken??{},{refreshToken:a,expiresIn:l}=e.tokenOutput??{};if(!t||!n||!o||!a)throw new i.CredentialsProviderError("Token refresh response missing required fields",{logger:this.logger,tryNextLink:!1});let g=new Date(Date.now()+(l??900)*1e3),f={...r,accessToken:{...r.accessToken,accessKeyId:t,secretAccessKey:n,sessionToken:o,expiresAt:g.toISOString()},refreshToken:a};await this.saveToken(f);let u=f.accessToken;return{accessKeyId:u.accessKeyId,secretAccessKey:u.secretAccessKey,sessionToken:u.sessionToken,accountId:u.accountId,expiration:g}}catch(e){if("AccessDeniedException"===e.name){let r;switch(e.error){case"TOKEN_EXPIRED":r="Your session has expired. Please reauthenticate.";break;case"USER_CREDENTIALS_CHANGED":r="Unable to refresh credentials because of a change in your password. Please reauthenticate with your new password.";break;case"INSUFFICIENT_PERMISSIONS":r="Unable to refresh credentials due to insufficient permissions. You may be missing permission for the 'CreateOAuth2Token' action.";break;default:r=`Failed to refresh token: ${String(e)}. Please re-authenticate using \`aws login\``}throw new i.CredentialsProviderError(r,{logger:this.logger,tryNextLink:!1})}throw new i.CredentialsProviderError(`Failed to refresh token: ${String(e)}. Please re-authenticate using aws login`,{logger:this.logger})}}async loadToken(){let e=this.getTokenFilePath();try{let r;try{r=await (0,d.readFile)(e,{ignoreCache:this.init?.ignoreCache})}catch{r=await f.promises.readFile(e,"utf8")}let t=JSON.parse(r),n=["accessToken","clientId","refreshToken","dpopKey"].filter(e=>!t[e]);if(t.accessToken?.accountId||n.push("accountId"),n.length>0)throw new i.CredentialsProviderError(`Token validation failed, missing fields: ${n.join(", ")}`,{logger:this.logger,tryNextLink:!1});return t}catch(r){throw new i.CredentialsProviderError(`Failed to load token from ${e}: ${String(r)}`,{logger:this.logger,tryNextLink:!1})}}async saveToken(e){let r=this.getTokenFilePath(),t=(0,_.dirname)(r);try{await f.promises.mkdir(t,{recursive:!0})}catch(e){}await f.promises.writeFile(r,JSON.stringify(e,null,2),"utf8")}getTokenFilePath(){let e=process.env.AWS_LOGIN_CACHE_DIRECTORY??(0,_.join)((0,u.homedir)(),".aws","login","cache"),r=Buffer.from(this.loginSession,"utf8"),t=(0,g.createHash)("sha256").update(r).digest("hex");return(0,_.join)(e,`${t}.json`)}derToRawSignature(e){let r=2;if(2!==e[2])throw Error("Invalid DER signature");r++;let t=e[r++],i=e.subarray(r,r+t);if(2!==e[r+=t])throw Error("Invalid DER signature");r++;let n=e[r++],s=e.subarray(r,r+n);i=0===i[0]?i.subarray(1):i,s=0===s[0]?s.subarray(1):s;let o=Buffer.concat([Buffer.alloc(32-i.length),i]),a=Buffer.concat([Buffer.alloc(32-s.length),s]);return Buffer.concat([o,a])}createDPoPInterceptor(e){e.add(e=>async r=>{if(c.HttpRequest.isInstance(r.request)){let e=r.request,t=`${e.protocol}//${e.hostname}${e.port?`:${e.port}`:""}${e.path}`,i=await this.generateDpop(e.method,t);e.headers={...e.headers,DPoP:i}}return e(r)},{step:"finalizeRequest",name:"dpopInterceptor",override:!0})}async generateDpop(e="POST",r){let t=await this.loadToken();try{let i=(0,g.createPrivateKey)({key:t.dpopKey,format:"pem",type:"sec1"}),n=(0,g.createPublicKey)(i).export({format:"der",type:"spki"}),s=-1;for(let e=0;e<n.length;e++)if(4===n[e]){s=e;break}let o=n.slice(s+1,s+33),a=n.slice(s+33,s+65),l={alg:"ES256",typ:"dpop+jwt",jwk:{kty:"EC",crv:"P-256",x:o.toString("base64url"),y:a.toString("base64url")}},c={jti:crypto.randomUUID(),htm:e,htu:r,iat:Math.floor(Date.now()/1e3)},d=Buffer.from(JSON.stringify(l)).toString("base64url"),f=Buffer.from(JSON.stringify(c)).toString("base64url"),u=`${d}.${f}`,_=(0,g.sign)("sha256",Buffer.from(u),i),p=this.derToRawSignature(_).toString("base64url");return`${u}.${p}`}catch(e){throw new i.CredentialsProviderError(`Failed to generate Dpop proof: ${e instanceof Error?e.message:String(e)}`,{logger:this.logger,tryNextLink:!1})}}}let h=async(e,s)=>{let o,a=await (o={...s,profile:e},async({callerClientConfig:e}={})=>{o?.logger?.debug?.("@aws-sdk/credential-providers - fromLoginCredentials");let s=await (0,t.parseKnownFiles)(o||{}),a=(0,r.getProfileName)({profile:o?.profile??e?.profile}),l=s[a];if(!l?.login_session)throw new i.CredentialsProviderError(`Profile ${a} does not contain login_session.`,{tryNextLink:!0,logger:o?.logger});let c=new p(l,o,e),d=await c.loadCredentials();return(0,n.setCredentialFeature)(d,"CREDENTIALS_LOGIN","AD")})();return(0,n.setCredentialFeature)(a,"CREDENTIALS_PROFILE_LOGIN","AC")},w=async(r,t)=>e.A(94343).then(({fromProcess:e})=>e({...r,profile:t})().then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_PROCESS","v"))),y=async(r,t,i={})=>{let{fromSSO:s}=await e.A(35117);return s({profile:r,logger:i.logger,parentClientConfig:i.parentClientConfig,clientConfig:i.clientConfig})().then(e=>t.sso_session?(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO","r"):(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_SSO_LEGACY","t"))},C=e=>!!e&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1&&["undefined","string"].indexOf(typeof e.aws_account_id)>-1,k=async(e,r)=>{r?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");let t={accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token,...e.aws_credential_scope&&{credentialScope:e.aws_credential_scope},...e.aws_account_id&&{accountId:e.aws_account_id}};return(0,n.setCredentialFeature)(t,"CREDENTIALS_PROFILE","n")},E=async(r,t)=>e.A(37104).then(({fromTokenFile:e})=>e({webIdentityTokenFile:r.web_identity_token_file,roleArn:r.role_arn,roleSessionName:r.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity,logger:t.logger,parentClientConfig:t.parentClientConfig})().then(e=>(0,n.setCredentialFeature)(e,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q"))),m=async(e,r,t,n={},s=!1)=>{let o=r[e];if(Object.keys(n).length>0&&C(o))return k(o,t);if(s||((e,{profile:r="default",logger:t}={})=>!!e&&"object"==typeof e&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1&&["undefined","string"].indexOf(typeof e.external_id)>-1&&["undefined","string"].indexOf(typeof e.mfa_serial)>-1&&(((e,{profile:r,logger:t})=>{let i="string"==typeof e.source_profile&&void 0===e.credential_source;return i&&t?.debug?.(`    ${r} isAssumeRoleWithSourceProfile source_profile=${e.source_profile}`),i})(e,{profile:r,logger:t})||((e,{profile:r,logger:t})=>{let i="string"==typeof e.credential_source&&void 0===e.source_profile;return i&&t?.debug?.(`    ${r} isCredentialSourceProfile credential_source=${e.credential_source}`),i})(e,{profile:r,logger:t})))(o,{profile:e,logger:t.logger}))return a(e,r,t,n,m);if(C(o))return k(o,t);if(o&&"object"==typeof o&&"string"==typeof o.web_identity_token_file&&"string"==typeof o.role_arn&&["undefined","string"].indexOf(typeof o.role_session_name)>-1)return E(o,t);if(o&&"object"==typeof o&&"string"==typeof o.credential_process)return w(t,e);if(o&&("string"==typeof o.sso_start_url||"string"==typeof o.sso_account_id||"string"==typeof o.sso_session||"string"==typeof o.sso_region||"string"==typeof o.sso_role_name))return await y(e,o,t);if(o&&o.login_session)return h(e,t);throw new i.CredentialsProviderError(`Could not resolve credentials using profile: [${e}] in configuration/credentials file(s).`,{logger:t.logger})},v=(e={})=>async({callerClientConfig:i}={})=>{let n={...e,parentClientConfig:{...i,...e.parentClientConfig}};n.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");let s=await (0,t.parseKnownFiles)(n);return m((0,r.getProfileName)({profile:e.profile??i?.profile}),s,n)};e.s(["fromIni",0,v],70903),e.i(70903),e.s(["fromIni",0,v],81386)},40077,e=>{e.v(r=>Promise.all(["server/chunks/45283_@aws-sdk_credential-provider-http_dist-es_index_cde35d3b.js"].map(r=>e.l(r))).then(()=>r(7541)))},54462,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__8604fa31._.js"].map(r=>e.l(r))).then(()=>r(26423)))},36989,e=>{e.v(r=>Promise.all(["server/chunks/5663e_@aws-sdk_credential-provider-env_dist-es_index_0da12fb2.js"].map(r=>e.l(r))).then(()=>r(63577)))},41435,e=>{e.v(r=>Promise.all(["server/chunks/16567__pnpm_b491f883._.js","server/chunks/6b371_@aws-sdk_nested-clients_dist-es_submodules_sts_index_29eb9d8c.js"].map(r=>e.l(r))).then(()=>r(32953)))},66803,e=>{e.v(r=>Promise.all(["server/chunks/16567__pnpm_b491f883._.js","server/chunks/6b371_@aws-sdk_nested-clients_dist-es_submodules_signin_index_4ac74484.js"].map(r=>e.l(r))).then(()=>r(10901)))},94343,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__e48a68d7._.js"].map(r=>e.l(r))).then(()=>r(84047)))},35117,e=>{e.v(r=>Promise.all(["server/chunks/46b35_@aws-sdk_credential-provider-sso_dist-es_96c2f486._.js"].map(r=>e.l(r))).then(()=>r(77458)))},37104,e=>{e.v(r=>Promise.all(["server/chunks/16567__pnpm_910a5a5e._.js"].map(r=>e.l(r))).then(()=>r(12193)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__196c8ed9._.js.map