module.exports=[24868,(e,r,i)=>{r.exports=e.x("fs/promises",()=>require("fs/promises"))},81823,46010,e=>{"use strict";var r=e.i(24868),i=e.i(54799),s=e.i(14747),o=e.i(1815);let t=e=>{let r=(0,i.createHash)("sha1").update(e).digest("hex");return(0,s.join)((0,o.getHomeDir)(),".aws","sso","cache",`${r}.json`)};e.s(["getSSOTokenFilepath",0,t],46010);let n={},a=async e=>{if(n[e])return n[e];let i=t(e);return JSON.parse(await (0,r.readFile)(i,"utf8"))};e.s(["getSSOTokenFromFile",0,a,"tokenIntercept",0,n],81823)},22734,(e,r,i)=>{r.exports=e.x("fs",()=>require("fs"))},44569,e=>{"use strict";var r=e.i(49079),i=e.i(23317),s=e.i(40273);let o=e=>Object.entries(e).filter(([e])=>e.startsWith(i.IniSectionType.SSO_SESSION+s.CONFIG_PREFIX_SEPARATOR)).reduce((e,[r,i])=>({...e,[r.substring(r.indexOf(s.CONFIG_PREFIX_SEPARATOR)+1)]:i}),{});var t=e.i(98160),n=e.i(96370);let a=()=>({}),l=async(e={})=>(0,n.readFile)(e.configFilepath??(0,r.getConfigFilepath)()).then(t.parseIni).then(o).catch(a);e.s(["loadSsoSessionData",0,l],44569)},77335,e=>{"use strict";var r=e.i(84330);class i extends r.ProviderError{name="TokenProviderError";constructor(e,r=!0){super(e,r),Object.setPrototypeOf(this,i.prototype)}}e.s(["TokenProviderError",()=>i])},7992,e=>{"use strict";var r=e.i(77335),i=e.i(84396),s=e.i(81823),o=e.i(44569),t=e.i(35926);let n="To refresh this SSO session run 'aws sso login' with the corresponding profile.",a=async(r,i={})=>{let{SSOOIDCClient:s}=await e.A(80194),o=e=>i.clientConfig?.[e]??i.parentClientConfig?.[e];return new s(Object.assign({},i.clientConfig??{},{region:r??i.clientConfig?.region,logger:o("logger"),userAgentAppId:o("userAgentAppId")}))},l=async(r,i,s={})=>{let{CreateTokenCommand:o}=await e.A(80194);return(await a(i,s)).send(new o({clientId:r.clientId,clientSecret:r.clientSecret,refreshToken:r.refreshToken,grantType:"refresh_token"}))},c=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new r.TokenProviderError(`Token is expired. ${n}`,!1)},g=(e,i,s=!1)=>{if(void 0===i)throw new r.TokenProviderError(`Value not present for '${e}' in SSO Token${s?". Cannot refresh":""}. ${n}`,!1)};var f=e.i(46010);let{writeFile:d}=e.i(22734).promises,p=new Date(0);e.s(["fromSso",0,(e={})=>async({callerClientConfig:a}={})=>{let h,u={...e,parentClientConfig:{...a,...e.parentClientConfig}};u.logger?.debug("@aws-sdk/token-providers - fromSso");let w=await (0,t.parseKnownFiles)(u),S=(0,i.getProfileName)({profile:u.profile??a?.profile}),_=w[S];if(_){if(!_.sso_session)throw new r.TokenProviderError(`Profile '${S}' is missing required property 'sso_session'.`)}else throw new r.TokenProviderError(`Profile '${S}' could not be found in shared credentials file.`,!1);let k=_.sso_session,m=(await (0,o.loadSsoSessionData)(u))[k];if(!m)throw new r.TokenProviderError(`Sso session '${k}' could not be found in shared credentials file.`,!1);for(let e of["sso_start_url","sso_region"])if(!m[e])throw new r.TokenProviderError(`Sso session '${k}' is missing required property '${e}'.`,!1);m.sso_start_url;let C=m.sso_region;try{h=await (0,s.getSSOTokenFromFile)(k)}catch(e){throw new r.TokenProviderError(`The SSO session token associated with profile=${S} was not found or is invalid. ${n}`,!1)}g("accessToken",h.accessToken),g("expiresAt",h.expiresAt);let{accessToken:v,expiresAt:T}=h,O={token:v,expiration:new Date(T)};if(O.expiration.getTime()-Date.now()>3e5)return O;if(Date.now()-p.getTime()<3e4)return c(O),O;g("clientId",h.clientId,!0),g("clientSecret",h.clientSecret,!0),g("refreshToken",h.refreshToken,!0);try{p.setTime(Date.now());let e=await l(h,C,u);g("accessToken",e.accessToken),g("expiresIn",e.expiresIn);let r=new Date(Date.now()+1e3*e.expiresIn);try{var P;let i;await (P={...h,accessToken:e.accessToken,expiresAt:r.toISOString(),refreshToken:e.refreshToken},i=(0,f.getSSOTokenFilepath)(k),d(i,JSON.stringify(P,null,2)))}catch(e){}return{token:e.accessToken,expiration:r}}catch(e){return c(O),O}}],7992)},77458,e=>{"use strict";e.s([],57924),e.i(57924);var r=e.i(3993),i=e.i(84396),s=e.i(44569),o=e.i(35926);let t=e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name);e.s(["isSsoProfile",0,t],29758);var n=e.i(18795),a=e.i(7992),l=e.i(81823);let c=async({ssoStartUrl:i,ssoSession:s,ssoAccountId:o,ssoRegion:t,ssoRoleName:c,ssoClient:g,clientConfig:f,parentClientConfig:d,profile:p,filepath:h,configFilepath:u,ignoreCache:w,logger:S})=>{let _,k,m="To refresh this SSO session run aws sso login with the corresponding profile.";if(s)try{let e=await (0,a.fromSso)({profile:p,filepath:h,configFilepath:u,ignoreCache:w})();_={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new r.CredentialsProviderError(e.message,{tryNextLink:!1,logger:S})}else try{_=await (0,l.getSSOTokenFromFile)(i)}catch(e){throw new r.CredentialsProviderError(`The SSO session associated with this profile is invalid. ${m}`,{tryNextLink:!1,logger:S})}if(new Date(_.expiresAt).getTime()-Date.now()<=0)throw new r.CredentialsProviderError(`The SSO session associated with this profile has expired. ${m}`,{tryNextLink:!1,logger:S});let{accessToken:C}=_,{SSOClient:v,GetRoleCredentialsCommand:T}=await e.A(60789),O=g||new v(Object.assign({},f??{},{logger:f?.logger??d?.logger,region:f?.region??t,userAgentAppId:f?.userAgentAppId??d?.userAgentAppId}));try{k=await O.send(new T({accountId:o,roleName:c,accessToken:C}))}catch(e){throw new r.CredentialsProviderError(e,{tryNextLink:!1,logger:S})}let{roleCredentials:{accessKeyId:P,secretAccessKey:y,sessionToken:x,expiration:E,credentialScope:A,accountId:I}={}}=k;if(!P||!y||!x||!E)throw new r.CredentialsProviderError("SSO returns an invalid temporary credential.",{tryNextLink:!1,logger:S});let F={accessKeyId:P,secretAccessKey:y,sessionToken:x,expiration:new Date(E),...A&&{credentialScope:A},...I&&{accountId:I}};return s?(0,n.setCredentialFeature)(F,"CREDENTIALS_SSO","s"):(0,n.setCredentialFeature)(F,"CREDENTIALS_SSO_LEGACY","u"),F},g=(e,i)=>{let{sso_start_url:s,sso_account_id:o,sso_region:t,sso_role_name:n}=e;if(!s||!o||!t||!n)throw new r.CredentialsProviderError(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}
Reference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger:i});return e};e.s(["validateSsoProfile",0,g],83327);let f=(e={})=>async({callerClientConfig:n}={})=>{e.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");let{ssoStartUrl:a,ssoAccountId:l,ssoRegion:f,ssoRoleName:d,ssoSession:p}=e,{ssoClient:h}=e,u=(0,i.getProfileName)({profile:e.profile??n?.profile});if(a||l||f||d||p)if(a&&l&&f&&d)return c({ssoStartUrl:a,ssoSession:p,ssoAccountId:l,ssoRegion:f,ssoRoleName:d,ssoClient:h,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:u,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger});else throw new r.CredentialsProviderError('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:e.logger});{let i=(await (0,o.parseKnownFiles)(e))[u];if(!i)throw new r.CredentialsProviderError(`Profile ${u} was not found.`,{logger:e.logger});if(!t(i))throw new r.CredentialsProviderError(`Profile ${u} is not configured with SSO credentials.`,{logger:e.logger});if(i?.sso_session){let o=(await (0,s.loadSsoSessionData)(e))[i.sso_session],t=` configurations in profile ${u} and sso-session ${i.sso_session}`;if(f&&f!==o.sso_region)throw new r.CredentialsProviderError("Conflicting SSO region"+t,{tryNextLink:!1,logger:e.logger});if(a&&a!==o.sso_start_url)throw new r.CredentialsProviderError("Conflicting SSO start_url"+t,{tryNextLink:!1,logger:e.logger});i.sso_region=o.sso_region,i.sso_start_url=o.sso_start_url}let{sso_start_url:n,sso_account_id:l,sso_region:d,sso_role_name:p,sso_session:w}=g(i,e.logger);return c({ssoStartUrl:n,ssoSession:w,ssoAccountId:l,ssoRegion:d,ssoRoleName:p,ssoClient:h,clientConfig:e.clientConfig,parentClientConfig:e.parentClientConfig,profile:u,filepath:e.filepath,configFilepath:e.configFilepath,ignoreCache:e.ignoreCache,logger:e.logger})}};e.s(["fromSSO",0,f],10989),e.i(10989),e.i(29758),e.s([],33882),e.i(33882),e.i(83327),e.s(["fromSSO",0,f,"isSsoProfile",0,t,"validateSsoProfile",0,g],77458)},80194,e=>{e.v(r=>Promise.all(["server/chunks/16567__pnpm_b491f883._.js","server/chunks/16567__pnpm_da82089a._.js","server/chunks/6b371_@aws-sdk_nested-clients_dist-es_submodules_sso-oidc_index_36689ca8.js"].map(r=>e.l(r))).then(()=>r(15425)))},60789,e=>{e.v(r=>Promise.all(["server/chunks/171ef_@smithy_core_dist-es_util-identity-and-auth_httpAuthSchemes_noAuth_c131b644.js","server/chunks/16567__pnpm_ad4ea36a._.js","server/chunks/16567__pnpm_da82089a._.js"].map(r=>e.l(r))).then(()=>r(74693)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7a23d073._.js.map